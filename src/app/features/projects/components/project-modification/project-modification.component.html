<div class="modification-container">
    <!-- Header -->
    <h2>Modifier un Projet</h2>

    <!-- Previsions Entr√©es -->
    <div class="section">
        <h3>Pr√©visions Entr√©es</h3>
        <form [formGroup]="previsionIncomesForm" (ngSubmit)="addPrevisionIncome()">
            <div class="form-row">
                <input type="date" formControlName="date" placeholder="Date" />
                <input type="text" formControlName="motif" placeholder="Motif" maxlength="255"/>
                <select formControlName="idCategory" (change)="onIncomeCategoryChange($event)">
                    <option *ngFor="let category of incomeCategories" [value]="category.idCategory">
                        {{ category.name }}
                    </option>
                </select>
                <select formControlName="idLibele" [disabled]="!filteredIncomeLibeles.length">
                    <option *ngFor="let libele of filteredIncomeLibeles" [value]="libele.idLibele">
                        {{ libele.libeleName }}
                    </option>
                </select>
                <input type="number" formControlName="montant" placeholder="Montant" />
                <button type="submit" [disabled]="previsionIncomesForm.invalid">+</button>
            </div>
        </form>

        <p-table [value]="previsionIncomes" [scrollable]="true" scrollDirection="both">
            <ng-template pTemplate="header">
                <tr>
                    <th>Date</th>
                    <th>Motif</th>
                    <th>Cat√©gorie</th>
                    <th>Libell√©</th>
                    <th>Montant</th>
                    <th>Cumul</th>
                    <th></th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-income>
                <tr>
                    <td>{{ income.date | date: 'dd/MM/yyyy' }}</td>
                    <td>{{ income.motif }}</td>
                    <td>{{ income.categoryName }}</td>
                    <td>{{ income.libeleName }}</td>
                    <td>{{ income.montant | currency: 'EUR' }}</td>
                    <td>{{ income.cumul | currency: 'EUR' }}</td>
                    <td>
                        <button
                                class="delete-btn"
                                (click)="deletePrevisionIncome(income.idPrevisionRentree)"
                                title="Delete this entry"
                        >
                            üóëÔ∏è
                        </button>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>

    <!-- Previsions Sorties -->
    <div class="section">
        <h3>Pr√©visions Sorties</h3>
        <form [formGroup]="previsionExpensesForm" (ngSubmit)="addPrevisionExpense()">
            <div class="form-row">
                <input type="date" formControlName="date" placeholder="Date" />
                <input type="text" formControlName="motif" placeholder="Motif" maxlength="255"/>
                <select formControlName="idCategory" (change)="onExpenseCategoryChange($event)">
                    <option *ngFor="let category of expenseCategories" [value]="category.idCategory">
                        {{ category.name }}
                    </option>
                </select>
                <select formControlName="idLibele" [disabled]="!filteredExpenseLibeles.length">
                    <option *ngFor="let libele of filteredExpenseLibeles" [value]="libele.idLibele">
                        {{ libele.libeleName }}
                    </option>
                </select>
                <input type="number" formControlName="montant" placeholder="Montant" />
                <button type="submit" [disabled]="previsionExpensesForm.invalid">+</button>
            </div>
        </form>

        <p-table [value]="previsionExpenses" [scrollable]="true" scrollDirection="both">
            <ng-template pTemplate="header">
                <tr>
                    <th>Date</th>
                    <th>Motif</th>
                    <th>Cat√©gorie</th>
                    <th>Libelles</th>
                    <th>Montant</th>
                    <th>Cumul</th>
                    <th></th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-expense>
                <tr>
                    <td>{{ expense.date | date: 'dd/MM/yyyy' }}</td>
                    <td>{{ expense.motif }}</td>
                    <td>{{ expense.categoryName }}</td>
                    <td>{{ !expense.estimationParCategorie ? expense.libeleName : '' }}</td>
                    <td>{{ expense.montant | currency: 'EUR' }}</td>
                    <td>{{ expense.cumul | currency: 'EUR' }}</td>
                    <td>
                        <button
                                class="delete-btn"
                                (click)="deletePrevisionExpense(expense.idPrevisionBudgetCategory || expense.idPrevisionBudgetLibele)"
                                title="Delete this entry"
                        >
                            üóëÔ∏è
                        </button>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>
</div>
